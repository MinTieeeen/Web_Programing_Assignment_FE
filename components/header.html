<nav class="np-navbar">
  <div class="np-container">
    <a href="/" class="np-brand">
      <img src="/assets/images/logo.png" alt="NextPlay logo" class="np-logo">
      <span class="np-brand-text">NextPlay</span>
    </a>

    <ul class="np-nav">
      <li><a href="#">Trang chủ</a></li>
      <li><a href="#">Khám phá</a></li>
      <li><a href="#">Tin tức</a></li>
      <li><a href="#">Về chúng tôi</a></li>
    </ul>

    <div class="np-right">
      <!-- Guest Actions (shown when not logged in) -->
      <div class="np-actions" id="guestActions">
        <a href="/user/register.html" class="np-btn np-btn-outline">Đăng ký</a>
        <a href="/user/login.html" class="np-btn np-btn-primary">Đăng nhập</a>
      </div>

      <!-- User Actions (shown when logged in) -->
      <div class="np-user-menu d-none" id="userMenu">
        <div class="np-user-info">
          <div class="np-user-avatar" id="userAvatar">
            <i class="bi bi-person-fill"></i>
          </div>
          <div class="np-user-details">
            <span class="np-user-name" id="userName">User Name</span>
            <span class="np-user-status">Đang trực tuyến</span>
          </div>
          <div class="np-user-dropdown">
            <button class="np-dropdown-toggle" id="userDropdownToggle">
              <i class="bi bi-chevron-down"></i>
            </button>
            <div class="np-dropdown-menu" id="userDropdownMenu">
              <a href="/user/profile.html" class="np-dropdown-item">
                <i class="bi bi-person"></i>
                <span>Hồ sơ</span>
              </a>
              <a href="/user/settings.html" class="np-dropdown-item">
                <i class="bi bi-gear"></i>
                <span>Cài đặt</span>
              </a>
              <a href="/user/orders.html" class="np-dropdown-item">
                <i class="bi bi-bag"></i>
                <span>Đơn hàng</span>
              </a>
              <div class="np-dropdown-divider"></div>
              <button class="np-dropdown-item" onclick="logout()">
                <i class="bi bi-box-arrow-right"></i>
                <span>Đăng xuất</span>
              </button>
            </div>
          </div>
        </div>
      </div>

      <button class="np-toggle" aria-label="Toggle navigation" data-toggle-target="#np-menu">
        <span></span><span></span><span></span>
      </button>
    </div>

    <div id="np-menu" class="np-menu">
      <ul class="np-nav-mobile">
        <li><a href="#">Trang chủ</a></li>
        <li><a href="#">Tin tức</a></li>
        <li><a href="#">Khám phá</a></li>
        <li><a href="#">Về chúng tôi</a></li>
      </ul>
      <!-- Mobile user menu -->
      <div class="np-mobile-user d-none" id="mobileUserMenu">
        <div class="np-mobile-user-info">
          <div class="np-mobile-avatar">
            <i class="bi bi-person-fill"></i>
          </div>
          <span class="np-mobile-username" id="mobileUserName">User Name</span>
        </div>
        <div class="np-mobile-actions">
          <a href="/user/profile.html" class="np-mobile-link">Hồ sơ</a>
          <a href="/user/settings.html" class="np-mobile-link">Cài đặt</a>
          <a href="/user/orders.html" class="np-mobile-link">Đơn hàng</a>
          <button class="np-mobile-logout" onclick="logout()">Đăng xuất</button>
        </div>
      </div>
    </div>
  </div>
</nav>

<script>
// Check user login status and update header
function updateHeaderLoginStatus() {
  const currentUser = localStorage.getItem('currentUser') || sessionStorage.getItem('currentUser');
  const guestActions = document.getElementById('guestActions');
  const userMenu = document.getElementById('userMenu');
  const mobileUserMenu = document.getElementById('mobileUserMenu');
  
  if (currentUser) {
    const userData = JSON.parse(currentUser);
    
    // Hide guest actions, show user menu
    if (guestActions) guestActions.classList.add('d-none');
    if (userMenu) userMenu.classList.remove('d-none');
    if (mobileUserMenu) mobileUserMenu.classList.remove('d-none');
    
    // Update user name
    const userName = document.getElementById('userName');
    const mobileUserName = document.getElementById('mobileUserName');
    if (userName) userName.textContent = userData.name || userData.username;
    if (mobileUserName) mobileUserName.textContent = userData.name || userData.username;
    
  } else {
    // Show guest actions, hide user menu
    if (guestActions) guestActions.classList.remove('d-none');
    if (userMenu) userMenu.classList.add('d-none');
    if (mobileUserMenu) mobileUserMenu.classList.add('d-none');
  }
}

// Logout function
function logout() {
  // Clear user data
  localStorage.removeItem('currentUser');
  sessionStorage.removeItem('currentUser');
  
  // Redirect to home page
  window.location.href = '/index.html';
}

// Toggle user dropdown
function toggleUserDropdown() {
  const dropdownMenu = document.getElementById('userDropdownMenu');
  if (dropdownMenu) {
    dropdownMenu.classList.toggle('show');
  }
}

// Close dropdown when clicking outside
document.addEventListener('click', function(event) {
  const userDropdown = document.getElementById('userDropdownToggle');
  const dropdownMenu = document.getElementById('userDropdownMenu');
  
  if (userDropdown && dropdownMenu && !userDropdown.contains(event.target) && !dropdownMenu.contains(event.target)) {
    dropdownMenu.classList.remove('show');
  }
});

// Initialize dropdown toggle
document.addEventListener('DOMContentLoaded', function() {
  const dropdownToggle = document.getElementById('userDropdownToggle');
  if (dropdownToggle) {
    dropdownToggle.addEventListener('click', toggleUserDropdown);
  }
  
  // Update header on page load
  updateHeaderLoginStatus();
});

// Listen for storage changes (when user logs in/out in another tab)
window.addEventListener('storage', updateHeaderLoginStatus);
</script>

