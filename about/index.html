<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Về Chúng Tôi - NextPlay</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.2/font/bootstrap-icons.css">
    <link rel="stylesheet" href="../assets/css/style.css">
    <link rel="stylesheet" href="../assets/css/header.css?v=sidebar_fix">
    <link rel="stylesheet" href="../assets/css/footer.css">
    <link rel="stylesheet" href="../assets/css/about.css">
    <link rel="stylesheet" href="../assets/css/toast.css">
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
</head>
<body>
    <div data-include="header"></div>

    <!-- Admin Controls -->
    <div id="admin-controls" class="d-none">
        <button id="btn-edit" class="btn btn-warning"><i class="bi bi-pencil-square"></i> Chỉnh sửa trang</button>
        <div id="edit-actions" class="d-none">
            <button id="btn-save" class="btn btn-success"><i class="bi bi-check-lg"></i> Lưu thay đổi</button>
            <button id="btn-cancel" class="btn btn-secondary"><i class="bi bi-x-lg"></i> Hủy</button>
        </div>
    </div>

    <!-- Hero Section -->
    <section class="hero-section">
        <div class="container text-center">
            <h1 class="hero-title editable" data-key="hero.title">Loading...</h1>
            <p class="hero-subtitle editable" data-key="hero.subtitle">Loading...</p>
        </div>
    </section>

    <!-- Intro Section -->
    <section class="intro-section">
        <div class="container">
            <div class="row align-items-center">
                <div class="col-lg-6 mb-4 mb-lg-0">
                    <div class="intro-img-wrapper editable-img-wrapper">
                        <img src="" alt="Intro" class="img-fluid rounded-4 shadow-lg editable-img" data-key="intro.image">
                        <div class="img-overlay">
                            <button class="btn btn-light btn-sm" onclick="changeImage('intro_image')">Đổi ảnh</button>
                        </div>
                    </div>
                </div>
                <div class="col-lg-6">
                    <h2 class="section-title editable" data-key="intro.title">Loading...</h2>
                    <p class="section-text editable" data-key="intro.content">Loading...</p>
                    
                    <!-- Stats -->
                    <div class="row mt-5" id="stats-container">
                        <!-- Injected via JS -->
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Features Section -->
    <section class="features-section">
        <div class="container">
            <div class="row" id="features-container">
                <!-- Injected via JS -->
            </div>
        </div>
    </section>

    <div data-include="footer"></div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../env.js"></script>
    <script src="../assets/js/include-components.js"></script>
    <script src="../assets/js/auth.js?v=2"></script>
    <script src="../assets/js/toast.js"></script>
    <script src="../assets/js/cart.js?v=2"></script>
    <script src="../assets/js/content-loader.js"></script>
    <script>
        let pageData = {};

        document.addEventListener('DOMContentLoaded', async () => {
            await loadPageContent();
        });

        async function loadPageContent() {
            try {
                const response = await fetch(`${window.ENV.API_URL}/settings/about_us`);
                const result = await response.json();

                if (result.status === 'success') {
                    pageData = result.data;
                    renderPage();
                }
            } catch (error) {
                console.error('Error loading page content:', error);
                if (document.querySelector('.hero-title').innerText === 'Loading...') {
                    document.querySelector('.hero-title').innerText = 'Về Chúng Tôi';
                    document.querySelector('.hero-subtitle').innerText = 'Không thể tải nội dung động. Vui lòng thử lại sau.';
                }
            }
        }

        function renderPage() {
            // Helper to get nested value
            const getVal = (obj, path) => path.split('.').reduce((acc, part) => acc && acc[part], obj);

            // Render Text Fields
            document.querySelectorAll('[data-key]').forEach(el => {
                const key = el.dataset.key;
                const value = getVal(pageData, key);
                if (value) {
                    if (el.tagName === 'IMG') {
                        el.src = value;
                    } else {
                        el.textContent = value;
                    }
                }
            });

            // Render Stats
            const statsContainer = document.getElementById('stats-container');
            if (pageData.stats) {
                statsContainer.innerHTML = pageData.stats.map((stat, index) => `
                    <div class="col-4 text-center">
                        <h3 class="stat-value">${stat.value}</h3>
                        <p class="stat-label">${stat.label}</p>
                    </div>
                `).join('');
            }

            // Render Features
            const featuresContainer = document.getElementById('features-container');
            if (pageData.features) {
                featuresContainer.innerHTML = pageData.features.map((feature, index) => `
                    <div class="col-md-4 mb-4">
                        <div class="feature-card text-center">
                            <div class="feature-icon">
                                <i class="bi ${feature.icon}"></i>
                            </div>
                            <h4 class="feature-title">${feature.title}</h4>
                            <p class="feature-desc">${feature.desc}</p>
                        </div>
                    </div>
                `).join('');
            }
        }
    </script>
</body>
</html>