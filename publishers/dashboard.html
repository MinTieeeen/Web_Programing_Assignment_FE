<!DOCTYPE html>
<html lang="vi">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Publisher Dashboard - NextPlay</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/publisher.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>
    <div class="publisher-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-gamepad"></i> NextPlay
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link active">
                        <i class="fas fa-home"></i> Tổng quan
                    </a>
                </li>
                <li class="nav-item">
                    <a href="games.html" class="nav-link">
                        <i class="fas fa-box-open"></i> Quản lí Game
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reviews.html" class="nav-link">
                        <i class="fas fa-star"></i> Đánh giá
                    </a>
                </li>
                <!-- <li class="nav-item">
                    <a href="revenue.html" class="nav-link">
                        <i class="fas fa-chart-line"></i> Revenue
                    </a>
                </li> -->
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <i class="fas fa-plus-circle"></i>Đăng game mới
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Dashboard</h1>
                <div class="user-profile">
                    <div class="user-info">
                        <div style="font-weight: 600; color: var(--text-light);" id="publisher-name">Publisher</div>
                        <div style="font-size: 12px; color: var(--text-muted);">Publisher</div>
                    </div>
                    <div class="user-avatar" id="user-avatar">P</div>
                </div>
            </div>

            <!-- Welcome Message -->
            <div
                style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%); border-radius: 16px; padding: 30px; margin-bottom: 30px; position: relative; overflow: hidden;">
                <div style="position: relative; z-index: 1;">
                    <h2 style="font-size: 28px; font-weight: 700; margin-bottom: 10px;">Hello <span
                            id="publisher-name-welcome">Publisher</span>!</h2>
                    <p style="font-size: 16px; opacity: 0.9; margin: 0;">Welcome back! Here's what's happening with your
                        games today.</p>
                </div>
                <div
                    style="position: absolute; top: -50px; right: -50px; width: 200px; height: 200px; background: rgba(255, 255, 255, 0.1); border-radius: 50%;">
                </div>
            </div>

            <!-- Stats Grid -->
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-title">Tổng số game</div>
                    <div class="stat-value" id="total-games">0</div>
                    <div style="color: var(--success); font-size: 14px; margin-top: 5px;">
                        <i class="fas fa-gamepad"></i> Tất cả game của bạn
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Người chơi tích cực</div>
                    <div class="stat-value" id="active-users">0</div>
                    <div style="color: var(--success); font-size: 14px; margin-top: 5px;">
                        <i class="fas fa-users"></i> Đang trực tuyến
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-title">Doanh thu tháng</div>
                    <div class="stat-value" id="monthly-revenue">0đ</div>
                    <div style="color: var(--success); font-size: 14px; margin-top: 5px;">
                        <i class="fas fa-chart-line"></i> Tháng này
                    </div>
                </div>
            </div>
            <!-- Charts Section -->
            <div class="charts-section">
                <div class="chart-container">
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin: 0; font-size: 20px; font-weight: 700;">Game được phát hành</h3>
                    </div>
                    <canvas id="revenueChart" style="height: 300px;"></canvas>
                </div>
                <div class="chart-container">
                    <div style="margin-bottom: 20px;">
                        <h3 style="margin: 0; font-size: 20px; font-weight: 700;">Hoạt động gần đây</h3>
                    </div>
                    <div style="background: rgba(0, 0, 0, 0.2); padding: 15px; border-radius: 10px; height: 300px; overflow-y: auto;">
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="width: 8px; height: 8px; background: var(--success); border-radius: 50%; margin-right: 10px;"></div>
                            <div>
                                <div style="font-size: 14px;">Đã cập nhật thông tin game</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Hôm nay, 14:30</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="width: 8px; height: 8px; background: var(--warning); border-radius: 50%; margin-right: 10px;"></div>
                            <div>
                                <div style="font-size: 14px;">Có 3 đánh giá mới cần kiểm duyệt</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Hôm nay, 11:15</div>
                            </div>
                        </div>
                        <div style="display: flex; align-items: center; padding: 10px 0; border-bottom: 1px solid rgba(255,255,255,0.1);">
                            <div style="width: 8px; height: 8px; background: var(--primary); border-radius: 50%; margin-right: 10px;"></div>
                            <div>
                                <div style="font-size: 14px;">Đã thêm game mới: "Đấu Trường Siêu Cấp"</div>
                                <div style="font-size: 12px; color: var(--text-muted);">Hôm qua, 16:45</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <style>
        .period-btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(0, 0, 0, 0.2);
            color: var(--text-muted);
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .period-btn:hover {
            background: rgba(108, 92, 231, 0.2);
            border-color: var(--primary-color);
        }

        .period-btn.active {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
            margin-bottom: 30px;
        }
    </style>

    <script>
        const API_URL = window.ENV.API_URL;
        const user = JSON.parse(localStorage.getItem('user') || '{}');

        if (user.uname) {
            document.getElementById('publisher-name').textContent = user.uname;
            document.getElementById('publisher-name-welcome').textContent = user.uname;
            document.getElementById('user-avatar').textContent = user.uname.charAt(0).toUpperCase();
        }

        async function fetchDashboardData() {
            try {
                // Giả lập dữ liệu thống kê
                const stats = {
                    totalGames: 12,
                    activeUsers: Math.floor(Math.random() * 5000) + 1000,
                    monthlyRevenue: (Math.random() * 50000 + 10000).toFixed(0),
                    newReviews: Math.floor(Math.random() * 50) + 5
                };

                // Cập nhật giao diện với dữ liệu mới
                document.getElementById('total-games').textContent = stats.totalGames;
                document.getElementById('active-users').textContent = stats.activeUsers.toLocaleString();
                document.getElementById('monthly-revenue').textContent = formatCurrency(stats.monthlyRevenue);
                document.getElementById('new-reviews').textContent = stats.newReviews;

                // Khởi tạo biểu đồ
                initRevenueChart();
            } catch (error) {
                console.error('Lỗi khi tải dữ liệu:', error);
            }
        }

        // Hàm định dạng tiền tệ
        function formatCurrency(amount) {
            return new Intl.NumberFormat('vi-VN', { 
                style: 'currency', 
                currency: 'VND',
                maximumFractionDigits: 0
            }).format(amount);
        }

        function initRevenueChart() {
            const ctx = document.getElementById('revenueChart').getContext('2d');

            const gradient = ctx.createLinearGradient(0, 0, 0, 300);
            gradient.addColorStop(0, 'rgba(108, 92, 231, 0.3)');
            gradient.addColorStop(1, 'rgba(108, 92, 231, 0.01)');

            // Dữ liệu mock cho 12 tháng gần nhất
            const months = ['Th1', 'Th2', 'Th3', 'Th4', 'Th5', 'Th6', 'Th7', 'Th8', 'Th9', 'Th10', 'Th11', 'Th12'];
            
            // Dữ liệu số game phát hành cố định cho 12 tháng
            const gameData = [2, 3, 1, 4, 3, 5, 4, 6, 5, 7, 6, 8];
            
            // Đảm bảo có ít nhất 1 game phát hành mỗi tháng
            gameData.forEach((value, index) => {
                if (value < 1) gameData[index] = 1;
            });

            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: months,
                    datasets: [{
                        label: 'Số game phát hành',
                        data: gameData,
                        backgroundColor: 'rgba(108, 92, 231, 0.8)',
                        borderColor: '#6c5ce7',
                        borderWidth: 2,
                        borderRadius: 4,
                        barThickness: 20,
                        hoverBackgroundColor: 'rgba(92, 74, 231, 1)'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            backgroundColor: '#2d2d44',
                            titleColor: '#f5f6fa',
                            bodyColor: '#b2bec3',
                            borderColor: 'rgba(255, 255, 255, 0.1)',
                            borderWidth: 1,
                            padding: 12,
                            displayColors: false,
                            callbacks: {
                                label: function (context) {
                                    return '$' + context.parsed.y.toLocaleString();
                                }
                            }
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                color: '#b2bec3',
                                callback: function (value) {
                                    return '$' + (value / 1000) + 'K';
                                }
                            },
                            grid: {
                                color: 'rgba(255, 255, 255, 0.05)',
                                drawBorder: false
                            }
                        },
                        x: {
                            ticks: {
                                color: '#b2bec3'
                            },
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        document.addEventListener('DOMContentLoaded', fetchDashboardData);
    </script>
</body>

</html>