<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Reviews & Feedback - NextPlay Publisher</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="../assets/css/publisher.css">
    <style>
        .tabs {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .tab-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            padding: 10px 20px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            border-bottom: 2px solid transparent;
            transition: all 0.3s ease;
        }

        .tab-btn.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .review-card {
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 15px;
            border: var(--glass-border);
            transition: transform 0.3s ease;
        }

        .review-card:hover {
            transform: translateY(-2px);
        }

        .review-header {
            display: flex;
            justify-content: space-between;
            margin-bottom: 10px;
        }

        .filter-bar {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
        }
    </style>
</head>

<body>
    <div class="publisher-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-logo">
                <i class="fas fa-gamepad"></i> NextPlay
            </div>
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-home"></i> Tổng quan
                    </a>
                </li>
                <li class="nav-item">
                    <a href="games.html" class="nav-link">
                        <i class="fas fa-box-open"></i> Quản lí Game
                    </a>
                </li>
                <li class="nav-item">
                    <a href="reviews.html" class="nav-link active">
                        <i class="fas fa-star"></i> Đánh giá
                    </a>
                </li>
                <!-- <li class="nav-item">
                    <a href="revenue.html" class="nav-link">
                        <i class="fas fa-chart-line"></i> Revenue
                    </a>
                </li> -->
                <li class="nav-item">
                    <a href="settings.html" class="nav-link">
                        <i class="fas fa-plus-circle"></i> Đăng game mới
                    </a>
                </li>
            </ul>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <div class="page-header">
                <h1 class="page-title">Reviews & Feedback</h1>
            </div>

            <div class="tabs">
                <button class="tab-btn active" onclick="switchTab('all')">Tấc cả đánh giá</button>
                <button class="tab-btn" onclick="switchTab('positive')">Tích cực</button>
                <button class="tab-btn" onclick="switchTab('negative')">Tiêu cực</button>
            </div>

            <div class="filter-bar">
                <select class="form-control" style="width: 100%; max-width: 300px;" id="gameFilter" onchange="filterReviews()">
                    <option value="all">Tất cả game</option>
                </select>
            </div>

            <div id="reviews-container">
                <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                    <i class="fas fa-spinner fa-spin" style="font-size: 24px;"></i>
                    <div style="margin-top: 10px;">Loading reviews...</div>
                </div>
            </div>
        </main>
    </div>

    <script>
        // Mock data
        const mockUser = { uid: 'publisher123', uname: 'GameStudio' };
        
        // Mock games data
        const mockGames = [
            { Gid: 1, name: 'Cyber Adventure' },
            { Gid: 2, name: 'Space Explorer' },
            { Gid: 3, name: 'Racing Legends' },
            { Gid: 4, name: 'Dungeon Crawler' },
            { Gid: 5, name: 'Zombie Survival' }
        ];
        
        // Mock reviews data
        const mockReviews = [
            {
                gameId: 1,
                gameName: 'Cyber Adventure',
                user: 'Gamer123',
                rating: 5,
                content: 'Trò chơi đồ họa đẹp, gameplay mượt mà. Rất đáng tiền!',
                date: '2025-12-05'
            },
            {
                gameId: 2,
                gameName: 'Space Explorer',
                user: 'StarGazer',
                rating: 4,
                content: 'Chơi rất thú vị nhưng cần thêm nhiều hành tinh để khám phá.',
                date: '2025-12-03'
            },
            {
                gameId: 3,
                gameName: 'Racing Legends',
                user: 'SpeedDemon',
                rating: 2,
                content: 'Đồ họa tốt nhưng có quá nhiều quảng cáo trong game.',
                date: '2025-11-28'
            },
            {
                gameId: 1,
                gameName: 'Cyber Adventure',
                user: 'ProGamer',
                rating: 5,
                content: 'Cốt truyện hấp dẫn, nhân vật đa dạng. Đáng chơi!',
                date: '2025-11-25'
            },
            {
                gameId: 4,
                gameName: 'Dungeon Crawler',
                user: 'AdventureSeeker',
                rating: 3,
                content: 'Game khá ổn nhưng độ khó hơi cao với người mới.',
                date: '2025-11-20'
            },
            {
                gameId: 5,
                gameName: 'Zombie Survival',
                user: 'SurvivalExpert',
                rating: 4,
                content: 'Chơi cùng bạn bè rất vui, đồ họa ấn tượng.',
                date: '2025-11-15'
            },
            {
                gameId: 2,
                gameName: 'Space Explorer',
                user: 'CosmicTraveler',
                rating: 1,
                content: 'Game bị lỗi nhiều, cần cập nhật sửa lỗi gấp!',
                date: '2025-11-10'
            }
        ];

        let allReviews = [];
        let gamesData = [];
        let currentTab = 'all';

        async function fetchData() {
            try {
                // Comment phần gọi API thật
                /*
                const gamesResponse = await fetch(`${API_URL}/games?publisher_id=${user.uid}`, {
                    credentials: 'include'
                });
                const gamesResult = await gamesResponse.json();

                if (gamesResult.status === 'success' && gamesResult.data) {
                    gamesData = gamesResult.data;
                    populateGameFilter();
                }
                */
                
                // Sử dụng dữ liệu mock
                gamesData = mockGames;
                allReviews = mockReviews;
                populateGameFilter();
                renderReviews();
                
            } catch (error) {
                console.error('Error:', error);
                // Vẫn hiển thị dữ liệu mock nếu có lỗi
                gamesData = mockGames;
                allReviews = mockReviews;
                populateGameFilter();
                renderReviews();
            }
        }

        function populateGameFilter() {
            const filter = document.getElementById('gameFilter');
            filter.innerHTML = '<option value="all">All Games</option>';
            gamesData.forEach(game => {
                filter.innerHTML += `<option value="${game.Gid}">${game.name}</option>`;
            });
        }

        function generateMockReviews() {
            const reviews = [];
            const users = ['Gamer123', 'ProPlayer', 'NoobMaster', 'GameFan99', 'EliteGamer'];
            const comments = [
                'Amazing graphics and gameplay!',
                'Good game, but needs more levels.',
                'Best game I\'ve played this year!',
                'Could be better, but still enjoyable.',
                'Not worth the price.',
                'Excellent storyline and mechanics!',
                'Fun but has some bugs.',
                'Highly recommended!'
            ];

            gamesData.forEach(game => {
                const reviewCount = Math.floor(Math.random() * 5) + 1;
                for (let i = 0; i < reviewCount; i++) {
                    reviews.push({
                        gameId: game.Gid,
                        gameName: game.name,
                        user: users[Math.floor(Math.random() * users.length)],
                        rating: Math.floor(Math.random() * 3) + 3, // 3-5 stars
                        content: comments[Math.floor(Math.random() * comments.length)],
                        date: new Date(Date.now() - Math.random() * 30 * 24 * 60 * 60 * 1000).toISOString().split('T')[0]
                    });
                }
            });

            return reviews;
        }

        function switchTab(tab) {
            currentTab = tab;
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            renderReviews();
        }

        function filterReviews() {
            renderReviews();
        }

        function renderReviews() {
            const container = document.getElementById('reviews-container');
            const gameFilter = document.getElementById('gameFilter').value;

            let filtered = allReviews.filter(review => {
                if (gameFilter !== 'all' && review.gameId != gameFilter) return false;
                if (currentTab === 'positive' && review.rating < 4) return false;
                if (currentTab === 'negative' && review.rating >= 4) return false;
                return true;
            });

            // Sort - Commented out as per user request
            // if (sortFilter === 'rating_high') {
            //     filtered.sort((a, b) => b.rating - a.rating);
            // } else if (sortFilter === 'rating_low') {
            //     filtered.sort((a, b) => a.rating - b.rating);
            // } else {
            //     filtered.sort((a, b) => new Date(b.date) - new Date(a.date));
            // }
            
            // Always sort by most recent
            filtered.sort((a, b) => new Date(b.date) - new Date(a.date));

            if (filtered.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 40px; color: var(--text-muted);">
                        <i class="fas fa-inbox" style="font-size: 48px; opacity: 0.3; margin-bottom: 10px;"></i>
                        <div>No reviews found.</div>
                    </div>
                `;
                return;
            }

            container.innerHTML = filtered.map(review => `
                <div class="review-card">
                    <div class="review-header">
                        <div style="display: flex; align-items: center; gap: 10px;">
                            <div style="width: 40px; height: 40px; background: var(--secondary-color); border-radius: 50%; display: flex; align-items: center; justify-content: center; font-weight: 700; color: white;">
                                ${review.user.charAt(0)}
                            </div>
                            <div>
                                <div style="font-weight: 600;">${review.user}</div>
                                <div style="font-size: 12px; color: var(--text-muted);">${review.gameName}</div>
                            </div>
                        </div>
                        <div style="text-align: right;">
                            <div class="star-rating" style="color: var(--warning);">
                                ${'★'.repeat(review.rating)}${'☆'.repeat(5 - review.rating)}
                            </div>
                            <div style="font-size: 12px; color: var(--text-muted); margin-top: 5px;">${review.date}</div>
                        </div>
                    </div>
                    <p style="margin-top: 10px; color: var(--text-light); line-height: 1.5; margin-bottom: 0;">
                        ${review.content}
                    </p>
                </div>
            `).join('');
        }

        function showError(message) {
            const container = document.getElementById('reviews-container');
            container.innerHTML = `
                <div style="text-align: center; padding: 40px; color: var(--danger);">
                    <i class="fas fa-exclamation-circle" style="font-size: 48px; margin-bottom: 10px;"></i>
                    <div>${message}</div>
                </div>
            `;
        }

        document.addEventListener('DOMContentLoaded', fetchData);
    </script>
</body>

</html>