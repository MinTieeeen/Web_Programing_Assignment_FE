<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý Tin tức và Đánh giá - NextPlay</title>
    <!-- Tabler Core -->
    <link href="../assets/tabler/css/tabler.min.css" rel="stylesheet"/>
    <link href="../assets/tabler/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="../assets/tabler/css/tabler-payments.min.css" rel="stylesheet"/>
    <link href="../assets/tabler/css/tabler-vendors.min.css" rel="stylesheet"/>
    <link href="../assets/css/toast.css" rel="stylesheet"/>
    <!-- Bootstrap removed to prevent conflict with Tabler -->
    <script src="../assets/tabler/js/tabler.min.js"></script>
    <script src="../env.js?v=2"></script>
    <script src="../assets/js/toast.js"></script>
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      body {
      	font-feature-settings: "cv03", "cv04", "cv11";
      }
    </style>
</head>
<body>
    <script src="../assets/tabler/js/tabler-theme.min.js"></script>
    <div class="page">
        <!-- Sidebar -->
        <div id="sidebarContainer"></div>

        <div class="page-wrapper">
            <!-- Navbar -->
            <div id="navbarContainer"></div>

            <!-- Page Header -->
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                Quản lý Tin tức & Đánh giá
                            </h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page Body -->
            <div class="page-body">
                <div class="container-xl">
                    <div class="card">
                        <div class="card-header">
                            <ul class="nav nav-tabs card-header-tabs" data-bs-toggle="tabs">
                                <li class="nav-item">
                                    <a href="#tabs-news" class="nav-link active" data-bs-toggle="tab">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                        Danh sách tin tức
                                    </a>
                                </li>
                                <li class="nav-item">
                                    <a href="#tabs-comments" class="nav-link" data-bs-toggle="tab">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M8 9h8" /><path d="M8 13h6" /><path d="M18 4a3 3 0 0 1 3 3v8a3 3 0 0 1 -3 3h-5l-5 3v-3h-2a3 3 0 0 1 -3 -3v-8a3 3 0 0 1 3 -3h12z" /></svg>
                                        Đánh giá
                                    </a>
                                </li>
                            </ul>
                        </div>
                        <div class="card-body">
                            <div class="tab-content">
                                <!-- NEWS TAB -->
                                <div class="tab-pane active show" id="tabs-news">
                                    <div class="d-flex mb-3">
                                        <div class="text-muted">
                                            <input type="text" class="form-control form-control-sm" id="searchNews" placeholder="Tìm kiếm tin tức...">
                                        </div>
                                        <div class="ms-auto">
                                            <a href="#" class="btn btn-primary d-none d-sm-inline-block" data-bs-toggle="modal" data-bs-target="#addNewsModal">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M12 5l0 14" /><path d="M5 12l14 0" /></svg>
                                                Thêm tin tức
                                            </a>
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table card-table table-vcenter text-nowrap datatable" id="newsTable">
                                            <thead>
                                                <tr>
                                                    <th>ID</th>
                                                    <th>Hình ảnh</th>
                                                    <th>Tiêu đề</th>
                                                    <th>Danh mục</th>
                                                    <th>Nguồn</th>
                                                    <th>Lượt xem</th>
                                                    <th>Ngày tạo</th>
                                                    <th>Thao tác</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                    <div class="mt-3">
                                        Total: <span id="totalNews" class="fw-bold">...</span> articles
                                    </div>
                                </div>

                                <!-- COMMENTS TAB -->
                                <div class="tab-pane" id="tabs-comments">
                                    <div class="d-flex mb-3">
                                        <div class="text-muted">
                                            <input type="text" class="form-control form-control-sm" id="searchComments" placeholder="Nội dung, người dùng...">
                                        </div>
                                    </div>
                                    <div class="table-responsive">
                                        <table class="table card-table table-vcenter text-nowrap datatable" id="commentsTable">
                                            <thead>
                                                <tr>
                                                    <th>Người dùng</th>
                                                    <th>Bài viết / Game</th>
                                                    <th>Đánh giá</th>
                                                    <th>Nội dung</th>
                                                    <th>Thời gian</th>
                                                    <th>Thao tác</th>
                                                </tr>
                                            </thead>
                                            <tbody></tbody>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <footer class="footer footer-transparent d-print-none">
                <div class="container-xl">
                     <div class="row text-center align-items-center flex-row-reverse">
                        <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                            Copyright &copy; 2025 <a href="." class="link-secondary">NextPlay</a>.
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Modals (Placed outside .page) -->
    
    <!-- Add News Modal -->
    <div class="modal modal-blur fade" id="addNewsModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Thêm tin tức mới</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                     <form id="addNewsForm">
                        <div class="mb-3">
                            <label class="form-label">Tiêu đề</label>
                            <input type="text" class="form-control" id="newsTitle" required>
                        </div>
                        <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Danh mục</label>
                                    <input type="text" class="form-control" id="newsCategory" placeholder="VD: Tin Game, Review..." required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Nguồn</label>
                                    <input type="text" class="form-control" id="newsSource" placeholder="VD: GameK, GenK..." required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Hình ảnh (URL)</label>
                            <input type="text" class="form-control" id="newsThumbnail" placeholder="https://...">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nội dung</label>
                            <textarea class="form-control" id="newsContent" rows="10" required></textarea>
                        </div>
                    </form>
                </div>
                 <div class="modal-footer">
                    <button type="button" class="btn me-auto" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="saveNews()">Lưu tin tức</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Edit News Modal -->
    <div class="modal modal-blur fade" id="editNewsModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content">
                 <div class="modal-header">
                    <h5 class="modal-title">Chỉnh sửa tin tức</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="editNewsForm">
                        <input type="hidden" id="editNewsId">
                        <div class="mb-3">
                            <label class="form-label">Tiêu đề</label>
                            <input type="text" class="form-control" id="editNewsTitle" required>
                        </div>
                         <div class="row">
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Danh mục</label>
                                    <input type="text" class="form-control" id="editNewsCategory" required>
                                </div>
                            </div>
                            <div class="col-lg-6">
                                <div class="mb-3">
                                    <label class="form-label">Nguồn</label>
                                    <input type="text" class="form-control" id="editNewsSource" required>
                                </div>
                            </div>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Hình ảnh (URL)</label>
                            <input type="text" class="form-control" id="editNewsThumbnail">
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Nội dung</label>
                            <textarea class="form-control" id="editNewsContent" rows="10" required></textarea>
                        </div>
                    </form>
                </div>
                 <div class="modal-footer">
                    <button type="button" class="btn me-auto" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-primary" onclick="updateNews()">Cập nhật</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Lock User Modal -->
    <div class="modal modal-blur fade" id="lockUserModal" tabindex="-1" role="dialog" aria-hidden="true">
        <div class="modal-dialog modal-sm modal-dialog-centered" role="document">
            <div class="modal-content">
                <div class="modal-body">
                    <div class="modal-title">Khóa tài khoản?</div>
                    <input type="hidden" id="lockUserId">
                    <div class="mb-2">Bạn có chắc chắn muốn khóa tài khoản <strong id="lockTargetUsername"></strong>?</div>
                    <div class="mb-3">
                        <label class="form-label">Thời gian khóa</label>
                        <select class="form-select" id="lockDuration">
                            <option value="15 minutes">15 phút</option>
                            <option value="1 hour">1 giờ</option>
                            <option value="1 day">1 ngày</option>
                            <option value="7 days">7 ngày</option>
                            <option value="30 days">30 ngày</option>
                            <option value="permanent" selected>Vĩnh viễn</option>
                        </select>
                    </div>
                    <div class="mb-2">
                         <label class="form-check">
                            <input class="form-check-input" type="checkbox" id="confirmLock">
                            <span class="form-check-label">Xác nhận khóa người dùng này</span>
                        </label>
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-link link-secondary me-auto" data-bs-dismiss="modal">Hủy</button>
                    <button type="button" class="btn btn-danger" onclick="submitLockUser()">Khóa tài khoản</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Logic Scripts -->
    <script src="../assets/js/admin/utils.js?v=2"></script>
    <script src="../assets/js/admin/components.js?v=7"></script>
    <script src="../assets/js/admin/news.js?v=5"></script>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            // Force remove any stuck backdrops
            document.querySelectorAll('.modal-backdrop').forEach(el => el.remove());
            document.body.classList.remove('modal-open');
            document.body.style.overflow = '';
            document.body.style.paddingRight = '';

            if (await AdminUtils.checkAuthentication()) {
                AdminComponents.init('news');
            }
        });
    </script>
</body>
</html>
