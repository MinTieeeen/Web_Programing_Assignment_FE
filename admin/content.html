<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quản lý nội dung trang - NextPlay Admin</title>
    <!-- Tabler Core -->
    <link href="../assets/tabler/css/tabler.min.css" rel="stylesheet"/>
    <link href="../assets/tabler/css/tabler-flags.min.css" rel="stylesheet"/>
    <link href="../assets/tabler/css/tabler-vendors.min.css" rel="stylesheet"/>
    <style>
      @import url('https://rsms.me/inter/inter.css');
      :root {
      	--tblr-font-sans-serif: 'Inter Var', -apple-system, BlinkMacSystemFont, San Francisco, Segoe UI, Roboto, Helvetica Neue, sans-serif;
      }
      .field-value {
          font-weight: 500;
          color: #1e293b;
      }
      .field-empty {
          color: #94a3b8;
          font-style: italic;
      }
      .view-mode, .edit-mode-container {
          background-color: #f8fafc;
          border: 1px solid #e2e8f0;
          border-radius: 8px;
          padding: 0.75rem 1rem;
          transition: all 0.2s ease;
      }
      .view-mode {
          cursor: default;
      }
      .view-mode .btn-edit-icon {
          opacity: 0.5;
          transition: all 0.2s ease;
          border-radius: 50%;
          padding: 4px;
      }
      .view-mode:hover .btn-edit-icon {
          opacity: 1;
          background-color: #e2e8f0;
          color: #3b82f6;
          transform: scale(1.1);
      }
      .edit-mode {
          display: none;
      }
      .edit-mode-container {
          background-color: #fff;
          border: 1px solid #cbd5e1;
          box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
          animation: slideDown 0.2s ease-out;
      }
      @keyframes slideDown {
          from { opacity: 0; transform: translateY(-5px); }
          to { opacity: 1; transform: translateY(0); }
      }
      .edit-actions {
          margin-top: 0.75rem;
          padding-top: 0.75rem;
          border-top: 1px dashed #e2e8f0;
          display: flex;
          justify-content: flex-end;
          gap: 0.75rem;
      }
      .edit-actions .btn {
          font-weight: 500;
          padding-left: 1.25rem;
          padding-right: 1.25rem;
      }
    </style>
</head>
<body>
    <script src="../assets/tabler/js/tabler-theme.min.js"></script>
    <div class="page">
        <!-- Sidebar -->
        <div id="sidebarContainer"></div>

        <div class="page-wrapper">
            <!-- Navbar -->
            <div id="navbarContainer"></div>

            <!-- Page Header -->
            <div class="page-header d-print-none">
                <div class="container-xl">
                    <div class="row g-2 align-items-center">
                        <div class="col">
                            <h2 class="page-title">
                                Quản lý nội dung trang
                            </h2>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Page Body -->
            <div class="page-body">
                <div class="container-xl">
                    <div class="row row-cards">
                        <!-- Site Info Section -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-info-circle me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 12a9 9 0 1 0 18 0a9 9 0 0 0 -18 0" /><path d="M12 9h.01" /><path d="M11 12h1v4h1" /></svg>
                                        Thông tin chung
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <!-- Email -->
                                    <div class="mb-4" id="group_info_email">
                                        <label class="form-label">Email liên hệ</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-mail me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M3 7a2 2 0 0 1 2 -2h14a2 2 0 0 1 2 2v10a2 2 0 0 1 -2 2h-14a2 2 0 0 1 -2 -2v-10z" /><path d="M3 7l9 6l9 -6" /></svg>
                                                <span class="field-value" id="view_info_email"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('info_email')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_info_email" placeholder="contact@example.com">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('info_email', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'email', 'info_email')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Phone -->
                                    <div class="mb-4" id="group_info_phone">
                                        <label class="form-label">Số điện thoại</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-phone me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M5 4h4l2 5l-2.5 1.5a11 11 0 0 0 5 5l1.5 -2.5l5 2v4a2 2 0 0 1 -2 2a16 16 0 0 1 -15 -15a2 2 0 0 1 2 -2" /></svg>
                                                <span class="field-value" id="view_info_phone"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('info_phone')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_info_phone" placeholder="+84...">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('info_phone', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'hotline', 'info_phone')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Address -->
                                    <div class="mb-4" id="group_info_address">
                                        <label class="form-label">Địa chỉ</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-map-pin me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 11a3 3 0 1 0 6 0a3 3 0 0 0 -6 0" /><path d="M17.657 16.657l-4.243 4.243a3 3 0 0 1 -4.242 0l-4.243 -4.243a8 8 0 1 1 11.314 0z" /></svg>
                                                <span class="field-value" id="view_info_address"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('info_address')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_info_address" placeholder="123 Street...">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('info_address', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'address', 'info_address')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- About -->
                                    <div class="mb-4" id="group_info_about">
                                        <label class="form-label">Mô tả ngắn (Footer)</label>
                                        <div class="view-mode p-2 border rounded bg-light position-relative">
                                             <div class="field-value" id="view_info_about" style="white-space: pre-wrap; min-height: 60px;"></div>
                                             <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon position-absolute top-0 end-0 m-2" onclick="toggleEdit('info_about')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <textarea class="form-control mb-2" id="input_info_about" rows="4"></textarea>
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('info_about', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'about', 'info_about')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Social Media Section -->
                        <div class="col-md-6">
                            <div class="card h-100">
                                <div class="card-header">
                                    <h3 class="card-title">
                                        <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-share me-2" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M6 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M18 6m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M18 18m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M8.7 10.7l6.6 -3.4" /><path d="M8.7 13.3l6.6 3.4" /></svg>
                                        Mạng xã hội
                                    </h3>
                                </div>
                                <div class="card-body">
                                    <div class="mb-4" id="group_social_facebook">
                                        <label class="form-label">Facebook</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center text-truncate">
                                                 <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-facebook me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M7 10v4h3v7h4v-7h3l1 -4h-4v-2a1 1 0 0 1 1 -1h3v-4h-3a5 5 0 0 0 -5 5v2h-3" /></svg>
                                                <span class="field-value text-truncate" id="view_social_facebook"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('social_facebook')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_social_facebook" placeholder="https://facebook.com/...">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('social_facebook', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'facebook', 'social_facebook')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4" id="group_social_twitter">
                                        <label class="form-label">Twitter / X</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center text-truncate">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-x me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4l11.733 16h4.267l-11.733 -16z" /><path d="M4 20l6.768 -6.768m2.46 -2.46l6.772 -6.772" /></svg>
                                                <span class="field-value text-truncate" id="view_social_twitter"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('social_twitter')">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_social_twitter" placeholder="https://twitter.com/...">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('social_twitter', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'twitter', 'social_twitter')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>

                                    <div class="mb-4" id="group_social_instagram">
                                        <label class="form-label">Instagram</label>
                                        <div class="view-mode d-flex justify-content-between align-items-center p-2 border rounded bg-light">
                                            <div class="d-flex align-items-center text-truncate">
                                                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-instagram me-2 text-muted" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 4m0 4a4 4 0 0 1 4 -4h8a4 4 0 0 1 4 4v8a4 4 0 0 1 -4 4h-8a4 4 0 0 1 -4 -4z" /><path d="M12 12m-3 0a3 3 0 1 0 6 0a3 3 0 1 0 -6 0" /><path d="M16.5 7.5l0 .01" /></svg>
                                                <span class="field-value text-truncate" id="view_social_instagram"></span>
                                            </div>
                                            <button class="btn btn-sm btn-icon btn-ghost-primary btn-edit-icon" onclick="toggleEdit('social_instagram')">
                                                 <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-pencil" width="20" height="20" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M4 20h4l10.5 -10.5a1.5 1.5 0 0 0 -4 -4l-10.5 10.5v4" /><path d="M13.5 6.5l4 4" /></svg>
                                            </button>
                                        </div>
                                        <div class="edit-mode edit-mode-container">
                                            <input type="text" class="form-control mb-2" id="input_social_instagram" placeholder="https://instagram.com/...">
                                            <div class="edit-actions">
                                                <button class="btn btn-sm btn-outline-secondary" onclick="toggleEdit('social_instagram', false)">Hủy</button>
                                                <button class="btn btn-sm btn-primary" onclick="saveContent('contact', 'instagram', 'social_instagram')">Lưu thay đổi</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
             <footer class="footer footer-transparent d-print-none">
                <div class="container-xl">
                    <div class="row text-center align-items-center flex-row-reverse">
                        <div class="col-12 col-lg-auto mt-3 mt-lg-0">
                            <ul class="list-inline list-inline-dots mb-0">
                                <li class="list-inline-item">
                                    Copyright &copy; 2025
                                    <a href="." class="link-secondary">NextPlay</a>.
                                    All rights reserved.
                                </li>
                            </ul>
                        </div>
                    </div>
                </div>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="../assets/tabler/js/tabler.min.js"></script>
    <script src="../env.js?v=2"></script>
    <script src="../assets/js/admin/utils.js?v=2"></script>
    <script src="../assets/js/admin/components.js?v=2"></script>
    <!-- Toast JS -->
    <script src="../assets/js/toast.js"></script>
    <script>
        if (!window.ENV || !window.ENV.API_URL) {
            throw new Error('[admin/content.html] ENV not loaded!');
        }
        const API_BASE_URL = window.ENV.API_URL;
        
        // Cache data
        let currentContent = {};

        document.addEventListener('DOMContentLoaded', async () => {
            await AdminComponents.init('content');
            loadContent();
        });

        async function loadContent() {
            try {
                const response = await fetch(`${API_BASE_URL}/content`);
                const result = await response.json();
                
                if (result.status === 'success') {
                    currentContent = result.data;
                    const contactData = currentContent.contact || {};
                    
                    // Populate views using 'contact' page_key data
                    renderField('info_email', contactData.email);
                    renderField('info_phone', contactData.hotline); // DB uses 'hotline'
                    renderField('info_address', contactData.address);
                    renderField('info_about', contactData.about); // Might be empty in DB

                    renderField('social_facebook', contactData.facebook);
                    renderField('social_twitter', contactData.twitter);
                    renderField('social_instagram', contactData.instagram);
                } else {
                    console.error('Failed to load content:', result);
                    Toast.error('Không thể tải nội dung trang');
                }

            } catch (error) {
                console.error('Error loading content:', error);
                Toast.error('Không thể tải nội dung trang');
            }
        }
        
        // Update these save calls in HTML manually or via this script replacing the onclicks? 
        // No, I need to update the onclick handlers in the HTML body as well because they use 'site_info' string.
        // Wait, replace_file_content cannot replace scattered onclick attributes easily.
        // I will use multi_replace for that in a separate call or here if possible. 
        // Actually, the previous 'saveContent' implementation took arguments. 
        // I should just update the saveContent calls in the HTML body. 
        // But for this tool call, I'll update the loadContent logic first.

        function renderField(key, value) {
            const viewEl = document.getElementById(`view_${key}`);
            const inputEl = document.getElementById(`input_${key}`);
            
            if (viewEl) {
                if (value && value.trim() !== '') {
                    viewEl.textContent = value;
                    viewEl.classList.remove('field-empty');
                } else {
                    viewEl.textContent = '(Chưa có thông tin)';
                    viewEl.classList.add('field-empty');
                }
            }
            if (inputEl) inputEl.value = value || '';
        }

        function toggleEdit(key, isEdit = true) {
            const group = document.getElementById(`group_${key}`);
            if (!group) return;

            const viewMode = group.querySelector('.view-mode');
            const editMode = group.querySelector('.edit-mode');
            const inputEl = document.getElementById(`input_${key}`);

            if (isEdit) {
                viewMode.style.display = 'none';
                editMode.style.display = 'block'; // Now using block for container
                inputEl.focus();
            } else {
                viewMode.style.display = 'flex'; // Restore proper display
                editMode.style.display = 'none';
            }
        }

        async function saveContent(pageKey, sectionKey, uniqueId) {
            const inputId = `input_${uniqueId}`;
            const value = document.getElementById(inputId).value;
            
            try {
                const response = await fetch(`${API_BASE_URL}/admin/content`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${localStorage.getItem('token')}`
                    },
                    body: JSON.stringify({
                        page_key: pageKey,
                        section_key: sectionKey,
                        content_value: value
                    })
                });

                const result = await response.json();
                if (result.status === 'success' || response.ok) {
                    Toast.success('Đã lưu thay đổi');
                    
                    // Update view
                    renderField(uniqueId, value);
                    toggleEdit(uniqueId, false);
                } else {
                    Toast.error('Lưu thất bại: ' + (result.message || 'Lỗi server'));
                }
            } catch (error) {
                console.error('Error saving content:', error);
                Toast.error('Lỗi kết nối');
            }
        }
    </script>
</body>
</html>
